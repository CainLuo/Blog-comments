
<!DOCTYPE html>
<html lang="zh-cn" class="loading">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç©è½¬iOSå¼€å‘ï¼šæ‘¸æ‘¸iOSçš„KVOæœºåˆ¶ - iOS Development</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate">
    <meta name="keywords" content="Fechin,"> 
    <meta name="description" content="KVO, å…¨åKey-Value Observing, æ˜¯ä¸€ç§å¯ä»¥è®©æˆ‘ä»¬è€Objective-CåŠ¨æ€ç‰¹æ€§å¹¶ä¸”å¯ä»¥å‡å°‘ä¸€äº›ç¹æ‚ä»£ç çš„ä¸€ç§æœºåˆ¶.
è½¬è½½å£°æ˜:å¦‚éœ€è¦è½¬è½½è¯¥æ–‡ç« , è¯·è”ç³»ä½œè€…, å¹¶ä¸”æ³¨æ˜å‡ºå¤„,"> 
    <meta name="author" content="CainLuo"> 
    <link rel="alternative" href="atom.xml" title="iOS Development" type="application/atom+xml"> 
    <link rel="icon" href="/iOSDevelopment/img/favicon.png"> 
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/iOSDevelopment/css/diaspora.css">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-8691406134231910",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads" src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
</head>
</html>
<body class="loading">
    <span id="config-title" style="display:none">iOS Development</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="icon-home image-icon" href="javascript:;" data-url="https://cainluo.github.io/iOSDevelopment"></a>
    <div title="æ’­æ”¾/æš‚åœ" class="icon-play"></div>
    <h3 class="subtitle">ç©è½¬iOSå¼€å‘ï¼šæ‘¸æ‘¸iOSçš„KVOæœºåˆ¶</h3>
    <div class="social">
        <!--<div class="like-icon">-->
            <!--<a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
        <!--</div>-->
        <div>
            <div class="share">
                <a title="è·å–äºŒç»´ç " class="icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">ç©è½¬iOSå¼€å‘ï¼šæ‘¸æ‘¸iOSçš„KVOæœºåˆ¶</h1>
        <div class="stuff">
            <span>å…«æœˆ 03, 2016</span>
            
  <ul class="post-tags-list"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/iOSDevelopment/tags/iOSåŸºç¡€/">iOSåŸºç¡€</a></li></ul>


        </div>
        <div class="content markdown">
            <p>KVO, å…¨åKey-Value Observing, æ˜¯ä¸€ç§å¯ä»¥è®©æˆ‘ä»¬è€Objective-CåŠ¨æ€ç‰¹æ€§å¹¶ä¸”å¯ä»¥å‡å°‘ä¸€äº›ç¹æ‚ä»£ç çš„ä¸€ç§æœºåˆ¶.</p>
<p><strong>è½¬è½½å£°æ˜:å¦‚éœ€è¦è½¬è½½è¯¥æ–‡ç« , è¯·è”ç³»ä½œè€…, å¹¶ä¸”æ³¨æ˜å‡ºå¤„, ä»¥åŠä¸èƒ½æ“…è‡ªä¿®æ”¹æœ¬æ–‡.</strong></p>
<h2 id="ä¸¾ä¸ªæ —å­"><a href="#ä¸¾ä¸ªæ —å­" class="headerlink" title="ä¸¾ä¸ªæ —å­"></a>ä¸¾ä¸ªæ —å­</h2><p>è¿™é‡Œä¸¾ä¸ªæ —å­ğŸŒ°, å…ˆä¸Šä»£ç , è¿™ä¸ªä»£ç å¾ˆç®€å•.</p>
<p>é¦–å…ˆæˆ‘ä»¬è¦æœ‰ä¸ªModelç±»:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation/Foundation.h</span><br><span class="line"></span><br><span class="line">@interface KVOModel : NSObject</span><br><span class="line"></span><br><span class="line">@property (nonatomic, assign) NSInteger number;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p>æœ‰äº†Modelç±»ä¹‹å, æˆ‘ä»¬åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„Controller, ç„¶åå†™ä¸€ä¸‹å¸ƒå±€çš„UIä»£ç :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - Labels</span><br><span class="line">- (UILabel *)beforeLabel &#123;</span><br><span class="line">    </span><br><span class="line">    if (!_beforeLabel) &#123;</span><br><span class="line">        </span><br><span class="line">        _beforeLabel = [[UILabel alloc] init];</span><br><span class="line">        </span><br><span class="line">        _beforeLabel.frame = CGRectMake(0,</span><br><span class="line">                                        120,</span><br><span class="line">                                        [UIScreen mainScreen].bounds.size.width,</span><br><span class="line">                                        30);</span><br><span class="line">        </span><br><span class="line">        _beforeLabel.text = @&quot;ä¹‹å‰çš„numberå€¼ä¸º: 0&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return _beforeLabel;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (UILabel *)afterLabel &#123;</span><br><span class="line">    </span><br><span class="line">    if (!_afterLabel) &#123;</span><br><span class="line">        </span><br><span class="line">        _afterLabel = [[UILabel alloc] init];</span><br><span class="line">        </span><br><span class="line">        _afterLabel.frame = CGRectMake(0,</span><br><span class="line">                                       150,</span><br><span class="line">                                       [UIScreen mainScreen].bounds.size.width,</span><br><span class="line">                                       30);</span><br><span class="line">        _afterLabel.text = @&quot;ç°åœ¨çš„numberå€¼ä¸º: 0&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return _afterLabel;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#pragma mark - Button</span><br><span class="line">- (UIButton *)touchButton &#123;</span><br><span class="line">    </span><br><span class="line">    if (!_touchButton) &#123;</span><br><span class="line">        </span><br><span class="line">        _touchButton = [[UIButton alloc] init];</span><br><span class="line">        _touchButton.frame = CGRectMake(0, 340, [UIScreen mainScreen].bounds.size.width, 50);</span><br><span class="line">        _touchButton.backgroundColor = [UIColor blueColor];</span><br><span class="line">        </span><br><span class="line">        [_touchButton setTitle:@&quot;æˆ‘å˜&quot;</span><br><span class="line">                      forState:UIControlStateNormal];</span><br><span class="line">        [_touchButton addTarget:self</span><br><span class="line">                         action:@selector(touchButtonAction)</span><br><span class="line">               forControlEvents:UIControlEventTouchUpInside];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return _touchButton;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)touchButtonAction &#123;</span><br><span class="line">    </span><br><span class="line">    self.kvoModel.number = self.kvoModel.number + 1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å­UIå°±æ­å»ºå®Œäº†, æˆ‘ä»¬æ¥çœ‹çœ‹ä¸‘é€¼çš„ç•Œé¢:</p>
<p><img src="https://raw.githubusercontent.com/CainLuo/iOS-Project-Example/master/KVO/Images/1.png" alt="1"></p>
<h2 id="å®ç°KVO"><a href="#å®ç°KVO" class="headerlink" title="å®ç°KVO"></a>å®ç°KVO</h2><p>è¿™é‡Œçš„KVOä»£ç æˆ‘å†™çš„ç®€å•ä¸€äº›äº›:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#pragma mark - Observe</span><br><span class="line">- (void)observeValueForKeyPath:(NSString *)keyPath</span><br><span class="line">                      ofObject:(id)object</span><br><span class="line">                        change:(NSDictionary&lt;NSKeyValueChangeKey,id *)change</span><br><span class="line">                       context:(void *)context &#123;</span><br><span class="line">    </span><br><span class="line">    if ([keyPath isEqualToString:@&quot;number&quot;] &amp;&amp; object == self.kvoModel) &#123;</span><br><span class="line">        </span><br><span class="line">        self.beforeLabel.text = [NSString stringWithFormat:@&quot;ä¹‹å‰çš„numberå€¼ä¸º: %@&quot;, [change valueForKey:@&quot;old&quot;]];</span><br><span class="line">        self.afterLabel.text  = [NSString stringWithFormat:@&quot;ç°åœ¨çš„numberå€¼ä¸º: %@&quot;, [change valueForKey:@&quot;new&quot;]];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ViewDidloadæ–¹æ³•é‡ŒåŠ ä¸Šäº†æ·»åŠ KVOçš„ä»£ç :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[self.kvoModel addObserver:self</span><br><span class="line">                forKeyPath:@&quot;number&quot;</span><br><span class="line">                   options:NSKeyValueObservingOptionOld | NSKeyValueObservingOptionNew</span><br><span class="line">                   context:nil];</span><br></pre></td></tr></table></figure>

<p>æœ€ååˆ«å¿˜äº†è¦ç§»é™¤KVO, ä¸ç„¶ä½ çš„Appä¸ºå•¥ä¼šCrashä½ ä¹Ÿä¸çŸ¥é“äº†.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (void)dealloc &#123;</span><br><span class="line">    </span><br><span class="line">    [self.kvoModel removeObserver:self</span><br><span class="line">                       forKeyPath:@&quot;number&quot;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆçš„æ•ˆæœ:</p>
<p><img src="https://raw.githubusercontent.com/CainLuo/iOS-Project-Example/master/KVO/Images/2.gif" alt="2"></p>
<h3 id="æ‰‹åŠ¨é€šçŸ¥å’Œè‡ªåŠ¨é€šçŸ¥"><a href="#æ‰‹åŠ¨é€šçŸ¥å’Œè‡ªåŠ¨é€šçŸ¥" class="headerlink" title="æ‰‹åŠ¨é€šçŸ¥å’Œè‡ªåŠ¨é€šçŸ¥"></a>æ‰‹åŠ¨é€šçŸ¥å’Œè‡ªåŠ¨é€šçŸ¥</h3><p>å…¶å®åœ¨åˆšåˆšçš„ä»£ç é‡Œ, æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨Buttonçš„ç‚¹å‡»äº‹ä»¶é‡Œ, å¹¶æ²¡æœ‰ç›´æ¥å¯¹Labelsè¿›è¡Œèµ‹å€¼, æ„Ÿè§‰æœ‰äº›å¾ˆç¥å¥‡, ä½†å®é™…ä¸Šå†…éƒ¨æ˜¯æœ‰è°ƒç”¨æ–¹æ³•çš„, å®ƒä»¬åˆ†åˆ«æ˜¯:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (void)willChangeValueForKey:(NSString *)key;</span><br><span class="line"></span><br><span class="line">- (void)didChangeValueForKey:(NSString *)key;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆè¿™ä¸¤ä¸ªæ–¹æ³•ä¼šåœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨å‘¢? ç­”æ¡ˆå°±åœ¨æˆ‘ä»¬åœ¨ç»™KVOModelçš„numberèµ‹å€¼æ—¶, åœ¨èµ‹å€¼çš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)setNumber:(NSInteger)number;</span><br></pre></td></tr></table></figure>

<p>é‚£å¦‚æœæˆ‘ä»¬è¦æ‰‹åŠ¨è°ƒç”¨æ€ä¹ˆåŠå‘¢? åˆ«æ€•, ä¸‹é¢ä¹Ÿæœ‰æ–¹æ³•:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (void)setNumber:(NSInteger)number &#123;</span><br><span class="line"></span><br><span class="line">    if (_number == number) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [self willChangeValueForKey:@&quot;number&quot;];</span><br><span class="line">    </span><br><span class="line">    _number = _number;</span><br><span class="line">    </span><br><span class="line">    [self didChangeValueForKey:@&quot;number&quot;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å­æˆ‘ä»¬å°±å…³é—­äº†è‡ªåŠ¨è°ƒç”¨:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (void)willChangeValueForKey:(NSString *)key;</span><br><span class="line"></span><br><span class="line">- (void)didChangeValueForKey:(NSString *)key;</span><br></pre></td></tr></table></figure>

<p>ä½†è¿™é‡Œè¦æ³¨æ„ä¸€ä¸‹, è™½ç„¶æˆ‘ä»¬å…³é—­äº†è‡ªåŠ¨è°ƒç”¨ä¹‹åå¯ä»¥æ‰‹åŠ¨è°ƒç”¨, ä½†è¿™æ ·å­åšå¹¶ä¸ä¼šæœ‰ä»€ä¹ˆå¤ªå¤šçš„å¥½å¤„, åè€Œè¿˜ä¼šå¢åŠ æ›´å¤šçš„ä»£ç é‡, æ‰€ä»¥è¿˜æ˜¯è®©ç³»ç»Ÿè‡ªå·±è°ƒç”¨ç®—äº†.</p>
<h2 id="é¢å¤–çš„æ€è€ƒ"><a href="#é¢å¤–çš„æ€è€ƒ" class="headerlink" title="é¢å¤–çš„æ€è€ƒ"></a>é¢å¤–çš„æ€è€ƒ</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬ä¼šé‡åˆ°ä¸€äº›æƒ…å†µä¸ä¼šå»ä½¿ç”¨KVOçš„è¾…åŠ©ç±», ä½†å¦‚æœè¦å¦å¤–åˆ›å»ºä¸€ä¸ªå¯¹è±¡, å°±ä¼šé¢å¤–å¢åŠ æ€§èƒ½çš„å¼€é”€, å¦‚æœæˆ‘ä»¬è§‚å¯Ÿå¾ˆå¤šå¯¹è±¡çš„è¯, é‚£å¼€é”€å°±æ›´åŠ çš„æ˜æ˜¾äº†, è¿™æ—¶å€™å’‹åŠ?</p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªå°å°çš„æƒ³æ³•, æˆ‘ä»¬åœ¨åˆ›å»ºç±»çš„æ—¶å€™, å°±è®©å®ƒè‡ªå·±æˆä¸ºè§‚å¯Ÿè€…å‘¢? æœ‰è¿™ä¸ªæƒ³æ³•, æˆ‘ä»¬å°±æ¥çœ‹çœ‹KVOçš„æ–¹æ³•:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (void)addObserver:(NSObject *)anObserver</span><br><span class="line">         forKeyPath:(NSString *)keyPath</span><br><span class="line">            options:(NSKeyValueObservingOptions)options</span><br><span class="line">            context:(void *)context;</span><br></pre></td></tr></table></figure>

<p>çœ‹å®Œä¹‹å, æˆ‘ä»¬åœ¨æƒ³, è²Œä¼¼ä¹Ÿå°±åªæœ‰ä¸€ä¸ªç‚¹å¯ä»¥åˆ‡å…¥, é‚£å°±æ˜¯context.</p>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±æ¥å†™å†™, é¦–å…ˆæˆ‘ä»¬åœ¨.mæ–‡ä»¶é‡Œè¦æœ‰ä¸€ä¸ªé™æ€å˜é‡:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static int const KVOContext;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬åœ¨è°ƒç”¨çš„æ—¶å€™æ·»åŠ è§‚å¯Ÿè€…APIçš„æ—¶å€™ä¼ å…¥è¿›å»:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[anyObject addObserver:self </span><br><span class="line">            forKeyPath:@&quot;someKey&quot; </span><br><span class="line">            options:someOptions </span><br><span class="line">            context:&amp;KVOContext];</span><br></pre></td></tr></table></figure>

<p>æœ€ååœ¨ç›‘å¬æ–¹æ³•é‡ŒåŠ ä¸¤å¥ä»£ç :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (void)observeValueForKeyPath:(NSString *)keyPath</span><br><span class="line">                      ofObject:(id)object</span><br><span class="line">                        change:(NSDictionary *)change</span><br><span class="line">                       context:(void *)context &#123;</span><br><span class="line">                       </span><br><span class="line">    if (context == &amp;KVOContext) &#123;</span><br><span class="line">        // è¿™é‡Œå†™ç›¸å…³çš„è§‚å¯Ÿä»£ç </span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        [super observeValueForKeyPath:keyPath </span><br><span class="line">                             ofObject:object </span><br><span class="line">                               change:change </span><br><span class="line">                              context:context];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å“¼å“¼, è¿™æ ·å­æˆ‘ä»¬å°±å¯ä»¥ä¿è¯ç»§æ‰¿ä¸è¿™ä¸ªç±»çš„å­ç±»å°±ç®—æ˜¯è§‚å¯ŸåŒä¸€ä¸ªå±æ€§, ä¹Ÿä¸ä¼šé€ æˆå†²çªå•¦.</p>
<h2 id="KVOçš„è¿›é˜¶"><a href="#KVOçš„è¿›é˜¶" class="headerlink" title="KVOçš„è¿›é˜¶"></a>KVOçš„è¿›é˜¶</h2><p>æœ‰è¿™ä¹ˆä¸€ä¸ªåœºæ™¯, å½“æŸä¸ªå€¼å‘ç”Ÿäº†æ”¹å˜æ—¶, å°±éœ€è¦åˆ·æ–°UIç•Œé¢, ä½†å¾€å¾€, æˆ‘ä»¬ä¹Ÿæ˜¯åœ¨ç¬¬ä¸€æ¬¡Buildingçš„æ—¶å€™æ‰åˆ·æ–°, é‚£è¿™ä¸ªæ—¶å€™å’‹åŠå’§?</p>
<p>KVOæä¾›äº†å››ä¸ªå¯é€‰é¡¹:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">typedef NS_OPTIONS(NSUInteger, NSKeyValueObservingOptions) &#123;</span><br><span class="line">    NSKeyValueObservingOptionNew = 0x01,</span><br><span class="line">    NSKeyValueObservingOptionOld = 0x02,</span><br><span class="line">    NSKeyValueObservingOptionInitial NS_ENUM_AVAILABLE(10_5, 2_0) = 0x04,</span><br><span class="line">    NSKeyValueObservingOptionPrior NS_ENUM_AVAILABLE(10_5, 2_0) = 0x08</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>NSKeyValueObservingOptionInitialå°±å¯ä»¥è§£å†³æˆ‘ä»¬åˆšåˆšæåˆ°çš„åœºæ™¯, åœ¨åˆå§‹çš„æ—¶å€™æ·»åŠ , ç„¶ååœ¨è°ƒç”¨ä¸‹é¢æ–¹æ³•çš„æ—¶å€™ä¹Ÿä¼šè§¦å‘.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (void)addObserver:(NSObject *)anObserver</span><br><span class="line">         forKeyPath:(NSString *)keyPath</span><br><span class="line">            options:(NSKeyValueObservingOptions)options</span><br><span class="line">            context:(void *)context;</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆNSKeyValueObservingOptionPriorå‘¢? è¿™ä¸ªæœ‰ç‚¹æ‹—å£, åœ¨æ³¨å†ŒKVOé€šçŸ¥çš„æ—¶å€™, å¦‚æœæˆ‘ä»¬åŠ ä¸Šäº†è¿™ä¸ªé€‰é¡¹, é‚£æˆ‘ä»¬å°±ä¼šå¾—åˆ°ä¸¤ä¸ªé€šçŸ¥, ä¸€ä¸ªæ˜¯ä¹‹å‰, ä¸€ä¸ªæ˜¯ä¹‹å, é‚£ä¹ˆå®ƒæ˜¯ä¼šä¸ä¸‹é¢è¿™ä¸ªæ–¹æ³•è¢«è§¦å‘çš„æ—¶é—´ç›¸åŒ:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)willChangeValueForKey:(NSString *)key;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯, è¿™é‡Œé¢ä¼šåœ¨changeå­—å…¸ä¸­æœ‰ä¸¤ä¸ªä¸åŒçš„é”®, ä¸ºäº†å¥½åŒºåˆ†, æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåˆ¤æ–­:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if ([change[NSKeyValueChangeNotificationIsPriorKey] boolValue]) &#123;</span><br><span class="line">    // æ”¹å˜ä¹‹å‰</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    // æ”¹å˜ä¹‹å</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‚£å¦‚æœæˆ‘ä»¬éœ€è¦è·å¾—æ”¹å˜å‰çš„å€¼å’Œæ”¹å˜åçš„å€¼, é‚£æˆ‘ä»¬åœ¨æ³¨å†ŒKVOé€šçŸ¥ä»£ç é‡Œæ·»åŠ NSKeyValueObservingOptionNewå’ŒNSKeyValueObservingOptionOld, ç„¶åè°ƒç”¨ä¸€ä¸‹å¾—ä»£ç :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id oldValue = change[@&quot;old&quot;];</span><br><span class="line">id newValue = change[@&quot;new&quot;];</span><br></pre></td></tr></table></figure>

<p>ä¸€èˆ¬æ¥è¯´, KVOæ˜¯ä¼šåœ¨è°ƒç”¨ä»¥ä¸‹æ–¹æ³•çš„æ—¶å€™å­˜å‚¨ç›¸å¯¹åº”é”®çš„å€¼:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (void)willChangeValueForKey:(NSString *)key;</span><br><span class="line"></span><br><span class="line">- (void)didChangeValueForKey:(NSString *)key;</span><br></pre></td></tr></table></figure>

<h2 id="é›†åˆç±»çš„KVO"><a href="#é›†åˆç±»çš„KVO" class="headerlink" title="é›†åˆç±»çš„KVO"></a>é›†åˆç±»çš„KVO</h2><p>åˆšåˆšæˆ‘ä»¬è¯´çš„éƒ½æ˜¯ä¸€å¯¹ä¸€çš„, é‚£å¦‚æœæˆ‘ä»¬æ˜¯ä¸€å¯¹å¤šå‘¢? æ”¾å¿ƒ, è‹¹æœä¹Ÿè€ƒè™‘åˆ°äº†è¿™ä¸ªé—®é¢˜, æ‰€ä»¥åœ¨è¿™é‡Œä¹Ÿæä¾›äº†å‡ ä¸ªæ–¹æ³•:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (NSMutableArray *)mutableArrayValueForKey:(NSString *)key;</span><br><span class="line">- (NSMutableSet *)mutableSetValueForKey:(NSString *)key;</span><br><span class="line">- (NSMutableOrderedSet *)mutableOrderedSetValueForKey:(NSString *)key NS_AVAILABLE(10_7, 5_0);</span><br></pre></td></tr></table></figure>

<p>ä¸€æ—¦é›†åˆç±»å‘ç”Ÿæ”¹å˜çš„æ—¶å€™, é‚£ä¹ˆä¹Ÿä¼šè°ƒç”¨KVOçš„ç›‘å¬æ–¹æ³•, ä½†è¿™é‡Œå°±éœ€è¦èŠ±ç‚¹å¿ƒæ€çš„å¼„å¼„äº†.</p>
<h2 id="KVOä¸çº¿ç¨‹ä¸å¾—ä¸è¯´çš„å¯†ç "><a href="#KVOä¸çº¿ç¨‹ä¸å¾—ä¸è¯´çš„å¯†ç " class="headerlink" title="KVOä¸çº¿ç¨‹ä¸å¾—ä¸è¯´çš„å¯†ç "></a>KVOä¸çº¿ç¨‹ä¸å¾—ä¸è¯´çš„å¯†ç </h2><p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹, KVOå®ƒæ˜¯å±äºåŒæ­¥è¿›è¡Œçš„è¡Œä¸º, å¹¶ä¸”å‘ç”Ÿä¸æ‰€è§‚å¯Ÿçš„å€¼å‘ç”Ÿå˜åŒ–çš„åŒæ ·çš„çº¿ç¨‹ä¸Š. è¿™é‡Œä¸å­˜åœ¨é˜Ÿåˆ—æˆ–è€…æ˜¯Run-loopçš„å¤„ç†, æ‰‹åŠ¨æˆ–è€…æ˜¯è‡ªåŠ¨è°ƒç”¨ä¸‹é¢çš„æ–¹æ³•éƒ½ä¼šè§¦å‘KVO:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)didChangeValueForKey:(NSString *)key;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥æˆ‘ä»¬æƒ³ä½œæ­»çš„å°è¯•å»ä»å…¶ä»–çº¿ç¨‹æ”¹å˜å±æ€§å€¼æ—¶, å°±è¦æ‰“é†’åäºŒåˆ†ç²¾ç¥äº†, é™¤éæ‰€æœ‰ä½ å¯ä»¥ä¿è¯æ‰€æœ‰è§‚å¯Ÿè€…éƒ½ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„æ–¹æ³•å»å¤„ç†KVO, ä¸ç„¶å°±Boom~~</p>
<p>ä½†é€šå¸¸æˆ‘ä»¬éƒ½ä¸ä¼šå»ºè®®æŠŠKVOå’Œå¤šçº¿ç¨‹æ··åœ¨ä¸€èµ·, å¦‚æœæ˜¯å¤šä¸ªé˜Ÿåˆ—çš„è¯å’Œçº¿ç¨‹çš„è¯, é‚£å°±æ›´ä¸åº”è¯¥åœ¨å®ƒä»¬ä¹‹é—´ä½¿ç”¨KVOäº†.</p>
<p>æ­£å¸¸æƒ…å†µä¸‹ä½¿ç”¨KVO, é‚£ä¹ˆKVOå°±ä¼šä¿è¯ä»¥ä¸‹ä¸¤ä¸ªæƒ…å†µå‘ç”Ÿ:</p>
<p>é¦–å…ˆ, æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªæ”¯æŒKVOçš„setterçš„æ–¹æ³•:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.age = 19;</span><br></pre></td></tr></table></figure>

<p>KVOå¯ä»¥ä¿è¯æ‰€æœ‰ageçš„è§‚å¯Ÿè€…åœ¨setteræ–¹æ³•è¿”å›å‰éƒ½è¢«é€šçŸ¥åˆ°.</p>
<p>å…¶æ¬¡, å¦‚æœæŸä¸ªé”®è¢«è§‚å¯Ÿçš„æ—¶å€™åŠ ä¸Šäº†NSKeyValueObservingOptionPrioré€‰é¡¹, ç›´åˆ°ä¸‹é¢çš„æ–¹æ³•è¢«è°ƒç”¨å‰, ageçš„accessoræ–¹æ³•éƒ½ä¼šè¿”å›ç›¸åŒçš„å€¼.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (void)observeValueForKeyPath:(NSString *)keyPath</span><br><span class="line">                      ofObject:(id)object</span><br><span class="line">                        change:(NSDictionary *)change</span><br><span class="line">                       context:(void *)context;</span><br></pre></td></tr></table></figure>

<h2 id="å·¥ç¨‹åœ°å€"><a href="#å·¥ç¨‹åœ°å€" class="headerlink" title="å·¥ç¨‹åœ°å€"></a>å·¥ç¨‹åœ°å€</h2><p>é¡¹ç›®åœ°å€: <a href="https://github.com/CainLuo/iOS-Project-Example/tree/master/KVO" target="_blank" rel="noopener">https://github.com/CainLuo/iOS-Project-Example/tree/master/KVO</a></p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        <li title='0' data-url='http://link.hhtjim.com/163/5146554.mp3'></li>
                    
                        <li title='1' data-url='http://link.hhtjim.com/qq/001faIUs4M2zna.mp3'></li>
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
        data-ae='true'
        data-ci='345ba2c1d8d1b80e1a7c'
        data-cs='170576df7da58eb1ff647403d422c689a68072c7'
        data-r='cainluo.github.io'
        data-o='CainLuo'
        data-a='CainLuo'
        data-d='false'
    >æŸ¥çœ‹è¯„è®º</div>


    </div>
    
        <div class='side'>
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ä¸¾ä¸ªæ —å­"><span class="toc-number">1.</span> <span class="toc-text">ä¸¾ä¸ªæ —å­</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å®ç°KVO"><span class="toc-number">2.</span> <span class="toc-text">å®ç°KVO</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#æ‰‹åŠ¨é€šçŸ¥å’Œè‡ªåŠ¨é€šçŸ¥"><span class="toc-number">2.1.</span> <span class="toc-text">æ‰‹åŠ¨é€šçŸ¥å’Œè‡ªåŠ¨é€šçŸ¥</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#é¢å¤–çš„æ€è€ƒ"><span class="toc-number">3.</span> <span class="toc-text">é¢å¤–çš„æ€è€ƒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KVOçš„è¿›é˜¶"><span class="toc-number">4.</span> <span class="toc-text">KVOçš„è¿›é˜¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#é›†åˆç±»çš„KVO"><span class="toc-number">5.</span> <span class="toc-text">é›†åˆç±»çš„KVO</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#KVOä¸çº¿ç¨‹ä¸å¾—ä¸è¯´çš„å¯†ç "><span class="toc-number">6.</span> <span class="toc-text">KVOä¸çº¿ç¨‹ä¸å¾—ä¸è¯´çš„å¯†ç </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å·¥ç¨‹åœ°å€"><span class="toc-number">7.</span> <span class="toc-text">å·¥ç¨‹åœ°å€</span></a></li></ol>
        </div>
    
</div>


    </div>
</div>
</body>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/iOSDevelopment/js/plugin.js"></script>
<script src="/iOSDevelopment/js/diaspora.js"></script>
<link rel="stylesheet" href="/iOSDevelopment/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/iOSDevelopment/photoswipe/default-skin/default-skin.css">
<script src="/iOSDevelopment/photoswipe/photoswipe.min.js"></script>
<script src="/iOSDevelopment/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>




</html>
