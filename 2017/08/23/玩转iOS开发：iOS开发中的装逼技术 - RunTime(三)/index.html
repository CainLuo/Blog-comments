
<!DOCTYPE html>
<html lang="zh-cn" class="loading">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç©è½¬iOSå¼€å‘ï¼šiOSå¼€å‘ä¸­çš„è£…é€¼æŠ€æœ¯ - RunTime(ä¸‰) - iOS Development</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate">
    <meta name="keywords" content="Fechin,"> 
    <meta name="description" content="æˆ‘ä»¬å·²ç»æ¥åˆ°äº†è£…é€¼æŠ€æœ¯å­¦ä¹ çš„ç¬¬ä¸‰éƒ¨åˆ†, å¦‚æœæ²¡æœ‰çœ‹åˆ°å‰é¢éƒ¨åˆ†çš„æœ‹å‹, å¯ä»¥å»çœ‹ç©è½¬iOSå¼€å‘ï¼šiOSå¼€å‘ä¸­çš„è£…é€¼æŠ€æœ¯ - RunTime(äºŒ).
è¿™æ¬¡è¯´çš„æ˜¯å•¥å‘¢? ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹
è½¬è½½å£°æ˜:å¦‚éœ€è¦,"> 
    <meta name="author" content="CainLuo"> 
    <link rel="alternative" href="atom.xml" title="iOS Development" type="application/atom+xml"> 
    <link rel="icon" href="/iOSDevelopment/img/favicon.png"> 
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/iOSDevelopment/css/diaspora.css">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-8691406134231910",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads" src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
</head>
</html>
<body class="loading">
    <span id="config-title" style="display:none">iOS Development</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="icon-home image-icon" href="javascript:;" data-url="https://cainluo.github.io/iOSDevelopment"></a>
    <div title="æ’­æ”¾/æš‚åœ" class="icon-play"></div>
    <h3 class="subtitle">ç©è½¬iOSå¼€å‘ï¼šiOSå¼€å‘ä¸­çš„è£…é€¼æŠ€æœ¯ - RunTime(ä¸‰)</h3>
    <div class="social">
        <!--<div class="like-icon">-->
            <!--<a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
        <!--</div>-->
        <div>
            <div class="share">
                <a title="è·å–äºŒç»´ç " class="icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">ç©è½¬iOSå¼€å‘ï¼šiOSå¼€å‘ä¸­çš„è£…é€¼æŠ€æœ¯ - RunTime(ä¸‰)</h1>
        <div class="stuff">
            <span>å…«æœˆ 23, 2017</span>
            
  <ul class="post-tags-list"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/iOSDevelopment/tags/iOSè¿›é˜¶/">iOSè¿›é˜¶</a></li></ul>


        </div>
        <div class="content markdown">
            <p>æˆ‘ä»¬å·²ç»æ¥åˆ°äº†è£…é€¼æŠ€æœ¯å­¦ä¹ çš„ç¬¬ä¸‰éƒ¨åˆ†, å¦‚æœæ²¡æœ‰çœ‹åˆ°å‰é¢éƒ¨åˆ†çš„æœ‹å‹, å¯ä»¥å»çœ‹<a href="https://cainluo.github.io/15034036545472.html">ç©è½¬iOSå¼€å‘ï¼šiOSå¼€å‘ä¸­çš„è£…é€¼æŠ€æœ¯ - RunTime(äºŒ)</a>.</p>
<p>è¿™æ¬¡è¯´çš„æ˜¯å•¥å‘¢? ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹</p>
<p><strong>è½¬è½½å£°æ˜:å¦‚éœ€è¦è½¬è½½è¯¥æ–‡ç« , è¯·è”ç³»ä½œè€…, å¹¶ä¸”æ³¨æ˜å‡ºå¤„, ä»¥åŠä¸èƒ½æ“…è‡ªä¿®æ”¹æœ¬æ–‡.</strong></p>
<h2 id="è‡ªåŠ¨å½’æ¡£"><a href="#è‡ªåŠ¨å½’æ¡£" class="headerlink" title="è‡ªåŠ¨å½’æ¡£"></a>è‡ªåŠ¨å½’æ¡£</h2><p>æˆ‘ä»¬å¹³å¸¸æ’¸å½’æ¡£çš„æ—¶å€™, æ˜¯æ€ä¹ˆå¼„çš„å‘¢? çœ‹çœ‹ä»£ç :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-Â (id)initWithCoder:(NSCoderÂ *)decoder &#123;</span><br><span class="line"></span><br><span class="line">    self = [super init];</span><br><span class="line"></span><br><span class="line">    ifÂ (selfÂ =Â [superÂ init])Â &#123;</span><br><span class="line"></span><br><span class="line">        NSObject *objÂ =Â [decoderÂ decodeObjectForKey:@&quot;keyName&quot;];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    returnÂ self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-Â (void)encodeWithCoder:(NSCoderÂ *)coder &#123;</span><br><span class="line"></span><br><span class="line">    NSObject *objÂ =Â [[NSObject alloc] init];</span><br><span class="line"></span><br><span class="line">    [coderÂ encodeObject:obj</span><br><span class="line">                 forKey:@&quot;keyName&quot;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹ä¸Šå»å¥½åƒæ²¡ä»€ä¹ˆé—®é¢˜, ä½†å¦‚æœæˆ‘ä»¬æœ‰ä¸€ç™¾ä¸ªå½’æ¡£æ€ä¹ˆåŠ, é‚£æˆ‘ä»¬å°±è¦ä¸€ä¸ªä¸€ä¸ªçš„å»å†™, å„ä¸€ç™¾ä¸ª, å†™çš„æ‰‹è½¯.</p>
<p>æ—¢ç„¶è®²åˆ°è¿™é‡Œ, é‚£è‚¯å®šæœ‰æ›´å¥½çš„æ–¹æ³•å»è§£å†³äº†, <strong>Runtime</strong>ä¹Ÿå¯ä»¥é€šè¿‡å‡ ä¸ªæ­¥éª¤ä¹‹å, è¿›è¡Œå½’æ¡£:</p>
<ul>
<li>é€šè¿‡<strong>class_copuIvarList</strong>æ–¹æ³•è·å–å½“å‰çš„<strong>Model</strong>çš„æ‰€æœ‰æˆå‘˜å˜é‡.</li>
<li>é€šè¿‡<strong>ivar_getName</strong>æ–¹æ³•æ¥è·å–æˆå‘˜å˜é‡çš„åç§°.</li>
<li>é€šè¿‡<strong>KVC</strong>æ¥è¯»å–<strong>Model</strong>çš„å±æ€§å€¼, æœ€åå°±ç»™<strong>Model</strong>çš„å±æ€§èµ‹å€¼, å°±å®Œäº‹.</li>
</ul>
<p>ä¸¾ä¸ªæ —å­ğŸŒ°ï¼Œæ–°å»ºäº†ä¸€ä¸ªåä¸º<strong>CoderModel</strong>çš„<strong>Model</strong>ç±»ï¼Œè¯¦ç»†ä»£ç ä¸º:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;CoderModel.h&quot;</span><br><span class="line">#import &lt;objc/runtime.h&gt;</span><br><span class="line">#import &lt;objc/message.h&gt;</span><br><span class="line"></span><br><span class="line">@implementation CoderModel</span><br><span class="line"></span><br><span class="line">- (void)encodeWithCoder:(NSCoder *)coder&#123;</span><br><span class="line">    </span><br><span class="line">    unsigned int outCount = 0;</span><br><span class="line">    </span><br><span class="line">    Ivar *vars = class_copyIvarList([self class], &amp;outCount);</span><br><span class="line">    </span><br><span class="line">    for (int i = 0; i &lt; outCount; i ++) &#123;</span><br><span class="line">        </span><br><span class="line">        Ivar var = vars[i];</span><br><span class="line">        </span><br><span class="line">        const char *name = ivar_getName(var);</span><br><span class="line">        </span><br><span class="line">        NSString *key = [NSString stringWithUTF8String:name];</span><br><span class="line">        </span><br><span class="line">        id value = [self valueForKey:key];</span><br><span class="line">        </span><br><span class="line">        [coder encodeObject:value</span><br><span class="line">                     forKey:key];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    free(vars);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (nullable instancetype)initWithCoder:(NSCoder *)decoder&#123;</span><br><span class="line">    </span><br><span class="line">    if (self = [super init]) &#123;</span><br><span class="line">        </span><br><span class="line">        unsigned int outCount = 0;</span><br><span class="line">        </span><br><span class="line">        Ivar *vars = class_copyIvarList([self class], &amp;outCount);</span><br><span class="line">        </span><br><span class="line">        for (int i = 0; i &lt; outCount; i ++) &#123;</span><br><span class="line">            </span><br><span class="line">            Ivar var = vars[i];</span><br><span class="line">            </span><br><span class="line">            const char *name = ivar_getName(var);</span><br><span class="line">            </span><br><span class="line">            NSString *key = [NSString stringWithUTF8String:name];</span><br><span class="line">            </span><br><span class="line">            id value = [decoder decodeObjectForKey:key];</span><br><span class="line">            </span><br><span class="line">            [self setValue:value forKey:key];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        free(vars);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<ul>
<li>è€è¿‡<strong>KVC</strong>çš„è€é“ä»¬éƒ½çŸ¥é“, <strong>KVC</strong>çš„ç‰¹æ€§, è‹¥èƒ½æ‰¾åˆ°<strong>key</strong>çš„å±æ€§<strong>setter</strong>æ–¹æ³•, å°±ä¼šè°ƒç”¨<strong>setter</strong>æ–¹æ³•.</li>
<li>å¦‚æœæ‰¾ä¸åˆ°<strong>setter</strong>, å°±ä¼šæŸ¥æ‰¾æˆå‘˜å˜é‡<strong>key</strong>æˆ–è€…æˆå‘˜å˜é‡<strong>_key</strong></li>
<li>æ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œä¸éœ€è¦å†å¦å¤–å¤„ç†å‰ç¼€æœ‰_å‰ç¼€çš„æˆå‘˜å˜é‡å</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬è¿˜éœ€è¦å†™ä¸€ä¸ªè½¬æ¨¡å‹çš„<strong>Category</strong>, è‡ªå·±åœ¨å·¥ç¨‹é‡Œæ‰¾å§, æœ€ç»ˆå®ç°:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (void)coderModel &#123;</span><br><span class="line">    </span><br><span class="line">    CoderModel *coderModel = [CoderModel objectWithKeyValues:self.dictionary];</span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;%@, %ld, %ld&quot;, coderModel.name, coderModel.age, coderModel.phoneNumber);</span><br><span class="line">    </span><br><span class="line">    NSDictionary *dictionary = [coderModel keyValuesWithObject];</span><br><span class="line">    </span><br><span class="line">    NSLog(@&quot;dictionary is %@&quot;, dictionary);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2017</span>-<span class="number">08</span>-<span class="number">23</span> <span class="number">22</span>:<span class="number">27</span>:<span class="number">51.349</span> <span class="number">1</span>.RunTime[<span class="number">36904</span>:<span class="number">3052474</span>] å°æ˜, -<span class="number">5764607523034234590</span>, -<span class="number">5764607302232026877</span></span><br><span class="line"></span><br><span class="line"><span class="number">2017</span>-<span class="number">08</span>-<span class="number">23</span> <span class="number">22</span>:<span class="number">27</span>:<span class="number">51.349</span> <span class="number">1</span>.RunTime[<span class="number">36904</span>:<span class="number">3052474</span>] dictionary <span class="keyword">is</span> &#123;</span><br><span class="line">    age = 18;</span><br><span class="line">    name = "\U5c0f\U660e";</span><br><span class="line">    phoneNumber = 13800138000;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å­—å…¸ä¸æ¨¡å‹äº’è½¬"><a href="#å­—å…¸ä¸æ¨¡å‹äº’è½¬" class="headerlink" title="å­—å…¸ä¸æ¨¡å‹äº’è½¬"></a>å­—å…¸ä¸æ¨¡å‹äº’è½¬</h3><p>åˆšåˆšè®²å®Œå½’æ¡£ä¹‹å, å°±é¡ºä¾¿æŠŠå­—å…¸ä¸æ¨¡å‹çš„äº’è½¬ç»™è¯´å®Œå§.</p>
<p>æˆ‘ä»¬ä»¥å‰ç»™æ¨¡å‹èµ‹å€¼çš„æ—¶å€™æ˜¯:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (instancetype)initWithDictionary:(NSDictionary *)dictionary &#123;</span><br><span class="line"></span><br><span class="line">    if (self = [super init]) &#123;</span><br><span class="line">    </span><br><span class="line">        self.age  = dictionary[@&quot;age&quot;];</span><br><span class="line">        self.name = dictionary[@&quot;name&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    return self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>çœ‹èµ·æ¥è²Œä¼¼æ²¡å•¥é—®é¢˜, ä½†å®é™…ä¸Šæ˜¯å’Œå½’æ¡£é‡åˆ°çš„é—®é¢˜ä¸€ä¸ªæ ·, åæ¥ç”¨è¿‡<strong>MJExtension</strong>, <strong>YYModel</strong>ä¹‹å, å°±å‘ç°, åŸæ¥æ¨¡å‹è§£æè¿˜å¯ä»¥æœ‰åˆ«çš„æ–¹å¼.</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹æµç¨‹:</p>
<ul>
<li><p>å­—å…¸è½¬æ¨¡å‹çš„æ—¶å€™</p>
</li>
<li><p>æ ¹æ®å­—å…¸çš„<strong>key</strong>ç”Ÿæˆ<strong>setter</strong>æ–¹æ³•</p>
</li>
<li><p>ä½¿ç”¨<strong>objc_msgSend</strong>è°ƒç”¨<strong>setter</strong>æ–¹æ³•ä¸º<strong>Model</strong>çš„å±æ€§èµ‹å€¼æˆ–è€…ç”¨<strong>KVC</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">+ (id)objectWithKeyValues:(NSDictionary *)dictionary &#123;</span><br><span class="line"></span><br><span class="line">    id objc = [[self alloc] init];</span><br><span class="line"></span><br><span class="line">    for (NSString *key in dictionary.allKeys) &#123;</span><br><span class="line"></span><br><span class="line">        id value = dictionary[key];</span><br><span class="line"></span><br><span class="line">        // åˆ¤æ–­å½“å‰å±æ€§æ˜¯å¦å±äºModel</span><br><span class="line">        objc_property_t property = class_getProperty(self, key.UTF8String);</span><br><span class="line"></span><br><span class="line">        unsigned int outCount = 0;</span><br><span class="line"></span><br><span class="line">        objc_property_attribute_t *attributeList = property_copyAttributeList(property, &amp;outCount);</span><br><span class="line"></span><br><span class="line">        objc_property_attribute_t attribute = attributeList[0];</span><br><span class="line"></span><br><span class="line">        NSString *typeString = [NSString stringWithUTF8String:attribute.value];</span><br><span class="line"></span><br><span class="line">        if ([typeString isEqualToString:@&quot;@\&quot;CoderModel\&quot;&quot;]) &#123;</span><br><span class="line"></span><br><span class="line">            value = [self objectWithKeyValues:value];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // ç”Ÿæˆsetteræ–¹æ³•ï¼Œå¹¶ç”¨objc_msgSendè°ƒç”¨</span><br><span class="line">        NSString *methodName = [NSString stringWithFormat:@&quot;set%@%@:&quot;, [key substringToIndex:1].uppercaseString, [key substringFromIndex:1]];</span><br><span class="line"></span><br><span class="line">        SEL setter = sel_registerName(methodName.UTF8String);</span><br><span class="line"></span><br><span class="line">        if ([objc respondsToSelector:setter]) &#123;</span><br><span class="line"></span><br><span class="line">            ((void (*) (id,SEL,id)) objc_msgSend) (objc,setter,value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        free(attributeList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return objc;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ¨¡å‹è½¬å­—å…¸çš„æ—¶å€™</p>
</li>
<li><p>è°ƒç”¨<strong>class_copyPropertyList</strong>æ–¹æ³•è·å–å½“å‰<strong>Model</strong>çš„æ‰€æœ‰å±æ€§</p>
</li>
<li><p>è°ƒç”¨ <strong>property_getName</strong> è·å–å±æ€§åç§°</p>
</li>
<li><p>æ ¹æ®å±æ€§åç§°ç”Ÿæˆ<strong>getter</strong>æ–¹æ³•</p>
</li>
<li><p>ä½¿ç”¨<strong>objc_msgSend</strong>è°ƒç”¨<strong>getter</strong>æ–¹æ³•è·å–å±æ€§å€¼æˆ–è€…ç”¨<strong>KVC</strong></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">- (NSDictionary *)keyValuesWithObject &#123;</span><br><span class="line"></span><br><span class="line">    unsigned int outCount = 0;</span><br><span class="line"></span><br><span class="line">    objc_property_t *propertyList = class_copyPropertyList([self class], &amp;outCount);</span><br><span class="line"></span><br><span class="line">    NSMutableDictionary *mutableDictionary = [NSMutableDictionary dictionary];</span><br><span class="line"></span><br><span class="line">    for (int i = 0; i &lt; outCount; i ++) &#123;</span><br><span class="line"></span><br><span class="line">        objc_property_t property = propertyList[i];</span><br><span class="line"></span><br><span class="line">        //ç”Ÿæˆgetteræ–¹æ³•ï¼Œå¹¶ç”¨objc_msgSendè°ƒç”¨</span><br><span class="line">        const char *propertyName = property_getName(property);</span><br><span class="line"></span><br><span class="line">        SEL getter = sel_registerName(propertyName);</span><br><span class="line"></span><br><span class="line">        if ([self respondsToSelector:getter]) &#123;</span><br><span class="line"></span><br><span class="line">            id value = ((id (*) (id,SEL)) objc_msgSend) (self,getter);</span><br><span class="line"></span><br><span class="line">            // åˆ¤æ–­å½“å‰å±æ€§æ˜¯å¦å±äºModel</span><br><span class="line">            if ([value isKindOfClass:[self class]] &amp;&amp; value) &#123;</span><br><span class="line"></span><br><span class="line">                value = [value keyValuesWithObject];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (value) &#123;</span><br><span class="line"></span><br><span class="line">                NSString *key = [NSString stringWithUTF8String:propertyName];</span><br><span class="line"></span><br><span class="line">                [mutableDictionary setObject:value</span><br><span class="line">                                      forKey:key];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    free(propertyList);</span><br><span class="line"></span><br><span class="line">    return mutableDictionary;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åŠ¨æ€æ–¹æ³•è§£æ"><a href="#åŠ¨æ€æ–¹æ³•è§£æ" class="headerlink" title="åŠ¨æ€æ–¹æ³•è§£æ"></a>åŠ¨æ€æ–¹æ³•è§£æ</h3><p>è¯´åˆ°è¿™é‡ŒåŸºæœ¬ä¸Šå°±å·²ç»ç»“æŸäº†, æœ€åå°±æ˜¯å¯¹å‰é¢æ²¡è®²çš„è¡¥å…….</p>
<p>ä¸€èˆ¬æˆ‘ä»¬è°ƒç”¨äº†å¯¹è±¡é‡Œä¸å­˜åœ¨é‡Œçš„æ–¹æ³•å°±ä¼šç›´æ¥å´©æ‰, ç„¶åç»™ä¸€ä¸ªé”™è¯¯ä¿¡æ¯:</p>
<pre><code>unrecognized selector sent to instance 0x0bcde09abc0</code></pre><p>ä½†æ˜¯åœ¨å´©æ‰ä¹‹å‰, <strong>Runtime</strong>ä¼šç»™ä¸€ä¸ªæœºä¼šæˆ‘ä»¬å»è¿›è¡ŒåŠ¨æ€è§£æ, æµç¨‹å¤§è‡´æ˜¯:</p>
<ul>
<li><p>æ£€æµ‹<strong>selector</strong>éœ€ä¸éœ€è¦å¿½ç•¥çš„, æ¯”å¦‚åœ¨<strong>macOS</strong>ä¸Šçš„å¼€å‘, æœ‰äº†<strong>ARC</strong>å°±ä¸ä¼šç†ä¼šä»€ä¹ˆ<strong>retain</strong>, <strong>release</strong>è¿™äº›æ–¹æ³•äº†.</p>
</li>
<li><p>æ£€æµ‹<strong>target</strong>æ˜¯ä¸æ˜¯ä¸º<strong>nil</strong>, <strong>Objective-C</strong>æ˜¯å…è®¸å¯¹ä¸€ä¸ª<strong>nil</strong>å¯¹è±¡éšä¾¿æ‰§è¡Œä¸€ä¸ªæ–¹æ³•éƒ½ä¸ä¼šå´©æ‰, æ‰€ä»¥å°±ä¼šè¢«å¿½ç•¥æ‰äº†, ä½†æ˜¯åœ¨<strong>Swift</strong>å°±ä¼šå‡ºé—®é¢˜äº†.</p>
</li>
<li><p>å¦‚æœä¸Šé¢ä¸¤ä¸ªéƒ½è¿‡äº†, é‚£å°±ä¼šå»æŸ¥æ‰¾è¿™ä¸ªç±»çš„<strong>IMP</strong>, å…ˆä»<strong>cache</strong>é‡Œé¢æ‰¾, æ‰¾åˆ°äº†å°±è·³åˆ°å¯¹åº”çš„å‡½æ•°å»æ‰§è¡Œ.</p>
</li>
<li><p>å¦‚æœ<strong>cache</strong>æ‰¾ä¸åˆ°å°±æ‰¾ä¸€ä¸‹æ–¹æ³•åˆ†å‘è¡¨</p>
</li>
<li><p>å¦‚æœåœ¨åˆ†å‘è¡¨é‡Œæ‰¾ä¸åˆ°, é‚£å°±ä¼šå»è¶…ç±»çš„åˆ†å‘è¡¨é‡Œå»æŸ¥æ‰¾, ä¸€ç›´æ‰¾åˆ°<strong>NSObject</strong>.</p>
</li>
<li><p>å¦‚æœè¿˜æ‰¾ä¸åˆ°å°±ä¼šå¼€å§‹è¿›å…¥æ¶ˆæ¯è½¬å‘</p>
</li>
</ul>
<p>è½¬å‘çš„å¤§è‡´è¿‡ç¨‹:</p>
<p><img src="https://raw.githubusercontent.com/cainluo/iOS-Project-Example/master/RunTime/Three/Images/1.jpg" alt="1"></p>
<p>å›¾ç‰‡æ˜¯åœ¨ç½‘ä¸Šçš„æŸä¸ªåšæ–‡é‡Œå·è¿‡æ¥çš„, æ‡’å¾—ç”»äº†.</p>
<ul>
<li><p>è¿›å…¥äº†<code>resolveInstanceMethod:</code>æ–¹æ³•å, æŒ‡å®šæ˜¯å¦æ˜¯åŠ¨æ€æ·»åŠ æ–¹æ³•.</p>
</li>
<li><p>å¦‚æœè¿”å›æ˜¯<strong>NO</strong>, å°±ä¼šè¿›å…¥ä¸‹ä¸€æ­¥</p>
</li>
<li><p>å¦‚æœè¿”å›<strong>YES</strong>, å°±ä¼šé€šè¿‡<strong>class_addMethod</strong>å‡½æ•°åŠ¨æ€çš„æ·»åŠ æ–¹æ³•, æ¶ˆæ¯å°±ä¼šå¾—åˆ°å¤„ç†, è¿™ä¸ªè¿‡ç¨‹å°±ä¼šç»“æŸäº†.</p>
</li>
<li><p><code>resolveInstanceMethod:</code>æ–¹æ³•è¿”å›<strong>NO</strong>æ—¶, å°±ä¼šè¿›å…¥<strong>forwardingTargetForSelector</strong>æ–¹æ³•, è¿™æ˜¯<strong>Runtime</strong>ç»™æˆ‘ä»¬çš„ç¬¬äºŒæ¬¡æœºä¼š, ç”¨äºæŒ‡å®šå“ªä¸ªå¯¹è±¡å“åº”è¿™ä¸ª<strong>selector</strong>.</p>
</li>
<li><p>å¦‚æœè¿”å›<strong>nil</strong>, å°±ä¼šè¿›å…¥ä¸‹ä¸€æ­¥, è¿”å›æŸä¸ªå¯¹è±¡, åˆ™ä¼šè°ƒç”¨è¯¥å¯¹è±¡çš„æ–¹æ³•.</p>
</li>
<li><p><code>forwardingTargetForSelector:</code>è¿”å›æ˜¯<strong>nil</strong>çš„è¯, æˆ‘ä»¬å°±è¦é€šè¿‡<code>methodSignatureForSelector:</code>æ¥æŒ‡å®šæ–¹æ³•ç­¾å.</p>
</li>
<li><p>å¦‚æœ<code>methodSignatureForSelector:</code>è¿”å›<strong>nil</strong>, å°±è¡¨ç¤ºä¸å¤„ç†, è¿”å›æ–¹æ³•ç­¾å, å°±ä¼šè¿›å…¥ä¸‹ä¸€æ­¥.</p>
</li>
<li><p>å½“<code>methodSignatureForSelector:</code>æ–¹æ³•è¿”å›ç­¾åå, å°±ä¼šè°ƒç”¨<code>forwardInvocation:</code>æ–¹æ³•, æˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>anInvocation</strong>å¯¹è±¡åšå¤„ç†, æ¯”å¦‚ä¿®æ”¹å®ç°æ–¹æ³•, ä¿®æ”¹å“åº”å¯¹è±¡ç­‰ç­‰.</p>
</li>
<li><p>å¦‚æœåˆ°æœ€åè¿™é‡Œ, æ¶ˆæ¯éƒ½è¿˜æ˜¯æ²¡æœ‰å¾—åˆ°å“åº”æˆ–å¤„ç†, é‚£ä¹ˆå°±ä¼šå´©æ‰äº†.</p>
</li>
</ul>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹ä»£ç :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;BicycleModel.h&quot;</span><br><span class="line">#import &quot;SportsCarModel.h&quot;</span><br><span class="line"></span><br><span class="line">#import &lt;objc/runtime.h&gt;</span><br><span class="line"></span><br><span class="line">@implementation BicycleModel</span><br><span class="line"></span><br><span class="line">- (void)ridingSpeed &#123;</span><br><span class="line"></span><br><span class="line">    NSLog(@&quot;Slow Ride&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (BOOL)resolveInstanceMethod:(SEL)sel &#123;</span><br><span class="line"></span><br><span class="line">#if 0</span><br><span class="line">    return NO;</span><br><span class="line">#else</span><br><span class="line">    class_addMethod(self, sel, class_getMethodImplementation(self, sel_registerName(&quot;ridingSpeed&quot;)), &quot;v@:&quot;);</span><br><span class="line"></span><br><span class="line">    return [super resolveInstanceMethod:sel];</span><br><span class="line">#endif</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (id)forwardingTargetForSelector:(SEL)aSelector&#123;</span><br><span class="line"></span><br><span class="line">#if 0</span><br><span class="line">    return nil;</span><br><span class="line">#else</span><br><span class="line">    return [[SportsCarModel alloc] init];</span><br><span class="line">#endif</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector &#123;</span><br><span class="line"></span><br><span class="line">    return [NSMethodSignature signatureWithObjCTypes:&quot;v@:&quot;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (void)forwardInvocation:(NSInvocation *)anInvocation &#123;</span><br><span class="line"></span><br><span class="line">    return [anInvocation invokeWithTarget:[[SportsCarModel alloc] init]];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#import &quot;SportsCarModel.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation SportsCarModel</span><br><span class="line"></span><br><span class="line">- (void)rapidAcceleration &#123;</span><br><span class="line"></span><br><span class="line">    NSLog(@&quot;High speed&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œæ–¹æ³•:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (void)dynamicAnalysis &#123;</span><br><span class="line"></span><br><span class="line">    BicycleModel *bicycle = [[BicycleModel alloc] init];</span><br><span class="line"></span><br><span class="line">    ((void (*) (id, SEL)) objc_msgSend) (bicycle, sel_registerName(&quot;rapidAcceleration&quot;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰“å°å‡ºæ¥çš„ç»“æœ:</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2017</span>-<span class="number">08</span>-<span class="number">24</span> <span class="number">00</span>:<span class="number">09</span>:<span class="number">15.238</span> <span class="number">1</span>.RunTime[<span class="number">37657</span>:<span class="number">3122648</span>] Slow Ride</span><br></pre></td></tr></table></figure>

<h2 id="å·¥ç¨‹åœ°å€"><a href="#å·¥ç¨‹åœ°å€" class="headerlink" title="å·¥ç¨‹åœ°å€"></a>å·¥ç¨‹åœ°å€</h2><p>é¡¹ç›®åœ°å€: <a href="https://github.com/cainluo/iOS-Project-Example/tree/master/RunTime/Three" target="_blank" rel="noopener">https://github.com/cainluo/iOS-Project-Example/tree/master/RunTime/Three</a></p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        <li title='0' data-url='http://link.hhtjim.com/163/5146554.mp3'></li>
                    
                        <li title='1' data-url='http://link.hhtjim.com/qq/001faIUs4M2zna.mp3'></li>
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
        data-ae='true'
        data-ci='345ba2c1d8d1b80e1a7c'
        data-cs='170576df7da58eb1ff647403d422c689a68072c7'
        data-r='cainluo.github.io'
        data-o='CainLuo'
        data-a='CainLuo'
        data-d='false'
    >æŸ¥çœ‹è¯„è®º</div>


    </div>
    
        <div class='side'>
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#è‡ªåŠ¨å½’æ¡£"><span class="toc-number">1.</span> <span class="toc-text">è‡ªåŠ¨å½’æ¡£</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#å­—å…¸ä¸æ¨¡å‹äº’è½¬"><span class="toc-number">1.1.</span> <span class="toc-text">å­—å…¸ä¸æ¨¡å‹äº’è½¬</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#åŠ¨æ€æ–¹æ³•è§£æ"><span class="toc-number">1.2.</span> <span class="toc-text">åŠ¨æ€æ–¹æ³•è§£æ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å·¥ç¨‹åœ°å€"><span class="toc-number">2.</span> <span class="toc-text">å·¥ç¨‹åœ°å€</span></a></li></ol>
        </div>
    
</div>


    </div>
</div>
</body>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/iOSDevelopment/js/plugin.js"></script>
<script src="/iOSDevelopment/js/diaspora.js"></script>
<link rel="stylesheet" href="/iOSDevelopment/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/iOSDevelopment/photoswipe/default-skin/default-skin.css">
<script src="/iOSDevelopment/photoswipe/photoswipe.min.js"></script>
<script src="/iOSDevelopment/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>




</html>
